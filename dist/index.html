<style scoped>
.status-message {
  border: 1px solid #c00;
  background: #fac7c7;
  padding: 10px;
}

.outer-wrapper {
  width: 100%;
  min-height: 900px;
  position: relative;
  border: 1px solid #c8c7cf;
}
.outer-wrapper h2, .outer-wrapper h3, .outer-wrapper p {
  padding: 10px 10px 0 10px;
  margin: 0;
}
.outer-wrapper ul {
  list-style: none;
  margin: 0;
  padding: 0;
  line-height: 11px;
}
.outer-wrapper li {
  border-radius: 5px;
  display: inline-block;
  position: relative;
  width: 10px;
  height: 10px;
  cursor: pointer;
  margin: 1px;
}
.outer-wrapper li > p {
  border-radius: 5px;
  position: absolute;
  background-color: #333;
  color: #eee;
  padding: 10px;
  z-index: 99;
  width: 100px;
  left: -40px;
  top: 14px;
  box-sizing: border-box;
  pointer-events: none;
  line-height: 1.3em;
  box-shadow: 2px 2px 5px #666666;
  -webkit-hyphens: auto;
     -moz-hyphens: auto;
      -ms-hyphens: auto;
          hyphens: auto;
}
.outer-wrapper li > p:before {
  content: "";
  position: absolute;
  top: -8px;
  left: 36px;
  border-bottom: 8px solid #333;
  border-left: 8px solid transparent;
  border-right: 8px solid transparent;
  border-top: 0;
  opacity: 1;
}
.outer-wrapper .inactive > p {
  display: none;
}
.outer-wrapper .mammals {
  background-color: #ef6930;
}
.outer-wrapper .birds {
  background-color: #9db58f;
}
.outer-wrapper .amphibians {
  background-color: #687a94;
}
.outer-wrapper .insects {
  background-color: #e5ae5a;
}
.outer-wrapper .null {
  background-color: #dddddd;
}

</style>
<div class="outer-wrapper">
	<div id="life-status-chart">
	
	</div>
</div>
<!--[if gt IE 8]><!-->
<script type="text/javascript">
function buildParams () {
	var params = {};

	params.colour =  [	"#ef6930", // mammals
						"#9db58f", // birds
						"#687a94", // amphibians
						"#e5ae5a" //  insects
					];

	params.uiColour = {
		veryLightGrey: "#ddd",
		lightGrey: "#999",
		grey: "#666",
		darkGrey: "#333"		
	};

	params.key = {};

	return params;
}

function buildData (data) {
	var updatedData = [];

	for (var i = 0; i < data.length; i++) {
		var myObject = {};

		myObject.class = data[i].class;
		myObject.status = data[i].status;

		if (data[i].common_names !== "") {
			myObject.names = data[i].common_names;
		} else if (data[i].synonyms !== "") {
			myObject.names = data[i].synonyms;
		} else {
			myObject.names = data[i].species;
		}
		myObject.name = myObject.names.split(',')[0].split('|')[0];
		
		updatedData.push(myObject);
	}

	updatedData.sort(compareClass);

	return updatedData;
}

/*	Function to sort papers by citation */
function compareClass(a,b) {
	if (a.class < b.class)
		return 1;
	if (a.class > b.class)
		return -1;
	return 0;
}
function BuildWidget (target, params, data) {
	this.target = target;
	this.params = params;
	this.data = data;
}

BuildWidget.prototype.buildList = function() {

	d3.select(this.target)
	  .append("ul")
		.selectAll("li")
		.data(this.data)
		.enter()
	  .append("li")
		.attr("class", function (d) {
			switch (d.class) {
				case "MAMMALIA":
					return "mammals";
					break;
				case "AVES":
					return "birds";
					break;
				case "AMPHIBIA":
					return "amphibians";
					break;
				case "INSECTA":
					return "insects";
					break;
				default:
					return "null";
			}
		})
		.classed("inactive", true)
		.html(function (d) {
			return "<p>" + d.name + "</p>";
		});
};

(function() {
		var init = function($)
		{
			/*	jQuery ready */
			$.when(
				$.getScript("http://www.nature.com/polopoly_static/js/d3.v3.min.js"),
				$.getScript("data/threatened_species_data.js")
			).done(function () {

				var lfStGraphic = new BuildWidget("#life-status-chart", buildParams(), buildData(data));
				lfStGraphic.buildList();

				$("li").on("mouseover", function() {
					$("li").addClass("inactive");
					$(this).removeClass("inactive");
				});

				$("ul").on("mouseleave", function () {
					$("li").addClass("inactive");
				});

			});

		/* End of active code */
		};


	setTimeout(function()
	{
	if (typeof jQuery !== 'undefined')
	{
		init(jQuery);
	} else
	{
		setTimeout(arguments.callee, 60);
	}
	}, 60);

})();
</script>
<!--<![endif]-->